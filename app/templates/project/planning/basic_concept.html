{% extends "base.html" %}

{% block content %}
<div class="content-section">
    <h2>作品基本构思 - {{ project.title }}</h2>
    
    <!-- 选定创意展示 -->
    <div class="card mb-4">
        <div class="card-header">
            选定创意
        </div>
        <div class="card-body">
            <h5 class="card-title">{{ expansion.summary }}</h5>
            <div class="row mb-3">
                <div class="col-md-4">
                    <strong>体裁:</strong> {{ expansion.genre }}
                </div>
                <div class="col-md-8">
                    <strong>主题:</strong> {{ expansion.theme }}
                </div>
            </div>
            <div class="card-text">
                <strong>创新点:</strong><br>
                {{ expansion.innovation_points }}
            </div>
        </div>
    </div>
    
    <!-- 生成构思按钮 -->
    {% if not concept %}
    <div class="text-center mb-4">
        <button id="generateConcept" class="btn btn-lg btn-primary">
            生成基本构思
        </button>
    </div>
    {% endif %}
    
    <!-- 基本构思展示 -->
    {% if concept %}
    <div class="card mb-4">
        <div class="card-header">
            作品基本构思
            <small class="text-muted float-right">
                生成于: {{ concept.created_at.strftime('%Y-%m-%d %H:%M') }}
            </small>
        </div>
        <div class="card-body">
            <!-- 世界观设定 -->
            <div class="mb-4">
                <h5>世界设定</h5>
                <p>{{ concept.world_setting|nl2br }}</p>
            </div>

            <div class="mb-4">
                <h5>文化背景</h5>
                <p>{{ concept.culture_background|nl2br }}</p>
            </div>

            <div class="mb-4">
                <h5>特殊元素</h5>
                <p>{{ concept.special_elements|nl2br }}</p>
            </div>

            <!-- 故事架构 -->
            <div class="mb-4">
                <h5>核心冲突</h5>
                <p>{{ concept.core_conflict|nl2br }}</p>
            </div>

            <div class="mb-4">
                <h5>故事大纲</h5>
                <p>{{ concept.plot_outline|nl2br }}</p>
            </div>

            <div class="mb-4">
                <h5>子情节设计</h5>
                <p>{{ concept.subplot_design|nl2br }}</p>
            </div>

            <div class="mb-4">
                <h5>关键事件</h5>
                <p>{{ concept.key_events|nl2br }}</p>
            </div>

            <div class="mb-4">
                <h5>情节推进</h5>
                <p>{{ concept.plot_progression|nl2br }}</p>
            </div>

            <!-- 人物系统 -->
            <div class="mb-4">
                <h5>主要人物</h5>
                <p>{{ concept.main_characters|nl2br }}</p>
            </div>

            <div class="mb-4">
                <h5>重要配角</h5>
                <p>{{ concept.supporting_characters|nl2br }}</p>
            </div>

            <div class="mb-4">
                <h5>人物关系</h5>
                <p>{{ concept.character_relationships|nl2br }}</p>
            </div>

            <div class="mb-4">
                <h5>人物成长</h5>
                <p>{{ concept.character_arcs|nl2br }}</p>
            </div>

            <!-- 主题与深度 -->
            <div class="mb-4">
                <h5>主题设计</h5>
                <p>{{ concept.theme_design|nl2br }}</p>
            </div>

            <div class="mb-4">
                <h5>哲学元素</h5>
                <p>{{ concept.philosophical_elements|nl2br }}</p>
            </div>

            <div class="mb-4">
                <h5>社会评论</h5>
                <p>{{ concept.social_commentary|nl2br }}</p>
            </div>

            <div class="mb-4">
                <h5>象征系统</h5>
                <p>{{ concept.symbolic_system|nl2br }}</p>
            </div>

            <!-- 叙事策略 -->
            <div class="mb-4">
                <h5>叙事视角</h5>
                <p>{{ concept.narrative_perspective|nl2br }}</p>
            </div>

            <div class="mb-4">
                <h5>时间线结构</h5>
                <p>{{ concept.timeline_structure|nl2br }}</p>
            </div>

            <div class="mb-4">
                <h5>节奏设计</h5>
                <p>{{ concept.pacing_design|nl2br }}</p>
            </div>

            <div class="mb-4">
                <h5>伏笔设置</h5>
                <p>{{ concept.foreshadowing|nl2br }}</p>
            </div>

            <!-- 写作风格 -->
            <div class="mb-4">
                <h5>写作风格</h5>
                <p>{{ concept.writing_style|nl2br }}</p>
            </div>

            <div class="mb-4">
                <h5>语言特色</h5>
                <p>{{ concept.language_features|nl2br }}</p>
            </div>

            <div class="mb-4">
                <h5>氛围营造</h5>
                <p>{{ concept.atmosphere_building|nl2br }}</p>
            </div>

            <div class="mb-4">
                <h5>文学手法</h5>
                <p>{{ concept.literary_devices|nl2br }}</p>
            </div>

            <!-- 规划信息 -->
            <div class="mb-4">
                <h5>章节结构</h5>
                <p>{{ concept.chapter_structure|nl2br }}</p>
            </div>

            <div class="mb-4">
                <h5>分卷规划</h5>
                <p>{{ concept.volume_planning|nl2br }}</p>
            </div>

            <div class="mb-4">
                <h5>预计字数</h5>
                <p>{{ concept.word_count_target }}</p>
            </div>

            <div class="mb-4">
                <h5>预计章节数</h5>
                <p>{{ concept.estimated_chapters }}</p>
            </div>
        </div>
    </div>
    {% endif %}
</div>

{% block scripts %}
<script>
$(document).ready(function() {
    // 生成基本构思
    $('#generateConcept').on('click', function() {
        $(this).prop('disabled', true).html(
            '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> 生成中...'
        );
        
        $.ajax({
            url: "{{ url_for('project_planning.basic_concept', 
                            project_id=project.id, 
                            expansion_id=expansion.id) }}",
            method: 'POST',
            success: function(response) {
                location.reload();
            },
            error: function(xhr) {
                alert('生成失败: ' + xhr.responseJSON.error);
                $('#generateConcept').prop('disabled', false)
                    .html('生成基本构思');
            }
        });
    });
});
</script>
{% endblock %}

{% endblock %}